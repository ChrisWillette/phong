<!DOCTYPE html>
<html lang="en">
<head>

	<meta charset="utf-8">

	<title>Toroidal Spiral Tube</title>

	<style>
		body {
			background-color : gray;
			font-family: "Arial Rounded MT Bold", "Helvetica Rounded", Arial, sans-serif;
		}
		h1 {
			font-size : 1.2em;
		}
		footer {
			font-size : 0.7 em;
			font-family: "Arial Rounded MT", "Helvetica Rounded", Arial, sans-serif;
			font-style: italic;
		}
	</style>

	<script src="matrix.js"></script>
	<script src="phong.js"></script>
	<script src="displayStuff.js"></script>

	<script id="vertex" type="x-shader">
		attribute vec3 vertexPosition;
		attribute vec3 vertexNormal;
		attribute vec2 vertexTexCoord;

		varying vec2 texCoord;
		varying vec4 color;

		uniform mat4 ModelViewProjection;
		uniform mat4 ModelViewMatrix;
		uniform mat3 NormalMatrix;
		uniform mat4 TextureMatrix;

		uniform vec3 ambientLight;
		uniform vec3 light0Color;
		uniform vec3 light0Position;

		uniform vec3 materialAmbient;
		uniform vec3 materialDiffuse;
		uniform vec3 materialSpecular;
		uniform float materialShininess;

		void main() {
			gl_Position = ModelViewProjection*vec4(vertexPosition,1.0);
			texCoord = (TextureMatrix*vec4(vertexTexCoord,0.0,1.0)).st;

			vec3 P = vec3(ModelViewMatrix * vec4(vertexPosition,1.0));
			vec3 N = normalize(NormalMatrix * vertexNormal);
			vec3 L = normalize(light0Position - P);

			vec3 I_ambient = materialAmbient * ambientLight;
			float cos_theta = dot(L,N);
			vec3 diffuseScale = light0Color * max(0.0, cos_theta);
			vec3 I_diffuse = materialDiffuse * diffuseScale;
			vec3 I_specular = vec3(0.0, 0.0, 0.0);

			if (cos_theta > 0.0) {
				vec3 R = reflect(-L,N);
				vec3 V = normalize(-P);
				float cos_alpha = dot(R,V);
				I_specular = materialSpecular * light0Color *
				pow(max(0.0, cos_alpha), materialShininess);
			}

			color = vec4(I_ambient + I_diffuse + I_specular, 1.0);
		}
	</script>

	<script id="fragment" type="x-shader">
		precision highp float;
		varying vec2 texCoord;
		varying vec4 color;
		uniform sampler2D texUnit;
		void main() {
			gl_FragColor = texture2D(texUnit, texCoord) * color;
		}
	</script>


</head>
<body onload="init(300, 128, 2, 5, 6.0, 2.0, 1); display()">
	<!-- 				init(N, M, p, q, a, b, R)-->
	<h1>Phong Shaded Torus with Spatially Varying Material Properties</h1>

	<canvas id="myCanvas" width="400" height="400"></canvas><br />
	Click and drag to rotate...<br>

<input min="1" max="10" value="2" oninput="changeTube('p', this)" onchange="changeTube('p', this)" type="range">p - winds around origin
<label id="p">2</label><br>
<input min="1" max="15" value="5" oninput="changeTube('q', this)" onchange="changeTube('q', this)" type="range">number of coils
<label id="q">2</label><br>

<script>
	function changeTube(label, factor){    
		if(label == 'p'){  
			tube.p = factor.value;
			document.getElementById('p').innerHTML = factor.value;
		}else{
			tube.q = factor.value;
			document.getElementById('q').innerHTML = factor.value;
		};
		tube.createGeometry();
		gl.bindBuffer(gl.ARRAY_BUFFER, tube.vertBuffer);
		gl.bufferData(gl.ARRAY_BUFFER, tube.verts, gl.STATIC_DRAW);
		tube.createTexCoords();
		gl.bindBuffer(gl.ARRAY_BUFFER, tube.texCoordBuffer);
		gl.bufferData(gl.ARRAY_BUFFER, tube.texCoords, gl.STATIC_DRAW);
		frame = requestAnimationFrame(display);
	}
</script>


	<hr>
	<footer>
		Chris Willette<br />
		December 15, 2016
	</footer>

</body>
</html>
